<article id="movie-show">
  <section class="ratable panel panel-info" id="movie-info">
    <%= image_tag @movie.image_url, id: "movie-img"%>
    <div id="movie-details">
      <div id="movie-title"><%= @movie.title %></div>
        <p class="panel-info">Average Rating: <span class="avg-rating"><%= number_to_percentage(@movie.average_rating, precision: 0) %></span></p>
        <p>Release Year: <%= @movie.release_year %></p>
        <p>Genres: <% @movie.genres.each do |genre| %>
          <%= link_to(genre.title_case, genre_path(genre), class: "btn btn-default")%>
        <% end %></p>
        <%= @movie.synopsis %>
      <%= render partial: "rating", locals: { ratable_type: "Movie" , ratable_id: @movie.id } %>
    </div>
  </section>

  <section class="panel panel-info" id="movie-info comments">
    <h3 id="">Movie Comments</h3>
    <% if logged_in? %>
      <%= form_for [@movie, @comment], :html => { :id => "movie-comment" } do |f| %>
        <%= f.text_area :content, placeholder: "write comment" %>
        <%= f.submit %>
      <% end %>
    <% end %>

    <% if flash[:notice] %>
      <%= flash[:notice] %>
    <% end %>

    <%= flash[:errors] %>
    <div id="comment-listing">
      <% @movie.comments.each do |comment| %>
      <div>
        <p><%= comment.content %></p>
        <p>commented by <%= comment.user.username %></p>
      </div>
      <% end %>
    </div>

  </section>

  <section>
    <div id="movie-reviews">
      <h3>Trusted Movie Reviews</h3>
      <% @movie.trusted_reviews.each do |review| %>
      <div class="ratable">
        <%= render partial: "review", locals: { review: review } %>
        <%= render partial: "rating", locals: { ratable_type: "Review" , ratable_id: review.id } %>

        <% if logged_in? %>
          <%= form_for [@movie, review, @comment], :html => { :class => "review-comment" } do |f| %>
            <%= f.hidden_field :review_id, :value => "#{review.id.to_s}" %>
            <%= f.text_area :content, placeholder: "write comment" %>
            <%= f.submit %>
          <% end %>
        <% end %>

      </div>
      <% end %>
      <h3>Other Movie Reviews</h3>
      <% @movie.untrusted_reviews.each do |review| %>
      <div class="ratable">
        <%= render partial: "review", locals: { review: review } %>
        <%= render partial: "rating", locals: { ratable_type: "Review" , ratable_id: review.id } %>

          <% if logged_in? %>
          <%= form_for [@movie, review, @comment], :html => { :class => "review-comment" } do |f| %>
            <%= f.hidden_field :review_id, :value => "#{review.id.to_s}" %>
            <%= f.text_area :content, placeholder: "write comment" %>
            <%= f.submit %>
          <% end %>
        <% end %>

      </div>

      <% end %>
    </div>
    <% if logged_in? %>
      <div id="new-review">
          <%= form_for [@movie, @review], remote: true do |f|  %>
            <%= f.text_field :title  %>
            <%= f.text_area :content  %>
            <%= f.submit  %>
          <% end %>
      </div>
  <% end %>

    <% if flash[:notice] %>
      <%= flash[:notice]  %>
    <% end %>
  </section>

</article>
</div>
